# 병렬 분산 시스템

## Scale-out

- 상대적으로 저성능 서버를 많은 수 사용하므로 서버 증설

## Scale-up

- 상대적으로 고성능 서버를 적게 사용하여 서버를 증설

데이터 중심 서비스에서는 Scale-out 구조를 많이 사용합니다. 고가의 서버들은 가격 관점에서 선형으로 성능향상이 일어나지 않기 때문입니다.

</br>

따라서 상대적으로 저성능의 서버를 여러대 병렬 분산하여 사용하여 Scale-out 구조를 구축합니다.

# MapReduce

## 데이터 중심 프로세싱

MapReduce는 병렬 분산 알고리즘 구현이 가능한 프레임워크입니다. 데이터 중심 프로세싱에서는 한대의 서버로 처리가 어려우므로 많은 서버를 묶어서 처리해줘야합니다. 

## 빅데이터를 이용한 효율적인 계산 프로그래밍 모델

기존의 여러 병렬 컴퓨팅 방법에는 로우레벨까지 학습이 필요합니다. Scale-out 구조로 서버 증설을 위해 서버를 추가하기만하면 되어 scalable한 빅데이터 병렬 처리 구현을 도와주는 간단한 프로그래밍 모델입니다.

# MapReduce Programming Model

맵리듀스는 함수형 프로그래밍 언어의 형태이며 유저는 3가지 함수를 구현하여 제공해야합니다.

- Main 함수
- Map 함수 : (key1, val1) → [(key2, val2)]
- Reduce 함수 : (key, [val2]) → [(key, val3)]

키, 밸류 페어로 제공되어 키와 밸류가 리스트로 반환됩니다(단일 반환값이 아님). 위와 같이 맵리듀스 프레임워크에서 각 레코드 혹은 튜플은 키-밸류 쌍으로 표현됩니다. 

</br>

# MapReduce Phase

맵리듀스 프레임워크는 **맵**과 **리듀스** 함수 한쌍으로 이루어진 **맵리듀스 페이즈를** 한번 혹은 여러번 반복하여 수행하여 동작합니다. 한 번의 맵리듀스 페이즈는 맵 → 리듀스 순서로 호출하며 맵 함수가 끝난 이후 **컴바인(Combine)** 함수를 중간에 수행할 수 있습니다.

<br/>

맵리듀스 페이즈는 드라이버에 해당하는 메인 프로그램에서 수행합니다.

또한 메인 함수를 하나의 마스터 머신에서 수행하여 맵 함수를 수행 전 전처리를 하거나, 리듀스 함수 이후 후처리를 하는데 사용합니다. 

## Map Phase

맵 페이즈는 제일 먼저 수행되며 데이터의 여러  파티션에 병렬 분산하여 수행됩니다. 각 머신마다 수행된 Mapper는 입력 데이터 한 줄마다 맵 함수를 호출합니다.

<br/>

키-밸류로 반환된 결과를 출력 및 여러 머신에 나누어 보내어 같은 키를 가진 키-밸류는 같은 머신으로 보내집니다.

호출하는 과정 자체는 시퀀셜하게 이루어지지만 호출된 여러 서버의 맵 함수를 통해 병렬 처리를 진행합니다.

## Shuffling Phase

모든 머신의 맵 페이즈가 끝나면 수행되는 페이즈로 맵페이즈에서 각각의 머신으로 보내진 키-밸류 쌍을 키 값으로 정렬하여 같은 키를 가진 키-밸류 쌍으로 밸류 리스트 형태로 여러 머신에 분산해서 보내게됩니다.

## Reduce Phase

모든 머신의 셔플렝 페이즈가 끝나면 수행되는 페이즈로 셔플링 페이즈에서 받은 각각의 키-밸류리스트 쌍마다 하나의 리듀스 함수를 수행합니다.

<br/>

하나의 리듀스 함수가 끝나면 다음 키-밸류리스트 쌍에 맞는 리듀스 함수가 다시 호출됩니다. 이 과정에서 출력이 있다면 키-밸류 쌍으로 값을 출력합니다.

# Hadoop

하둡은 Apache 프로젝트의 맵리듀스 프레임워크 오픈소스입니다. 수행을 분산하는 맵리듀스와 파일을 부산하는 하둡 분산 파일 시스템으로 이루어져 있습니다.

<br/>

하나의 Namenode(master)와 여러 Datanode(slaves)로 구성됩니다. Namenode는 파일 시스템을 관리하고 Datanode는 컴퓨터에 들어있는 데이터를 접근할 수 있게합니다. 

## **하둡 분산 파일 시스템(Hadoop Distirbuted File System - HDFS)**

하나의 빅데이터 파일을 여러대의 컴퓨터에 나누어서 저장하며 각 파일은 여러개의 순차적인 블록으로 저장합니다.

<br/> 

각각의 블록은 폴트 톨러런스(시스템 결함에도 정상 기능 수행)을 위해 여러 개로 복사되어 저장됩니다.

## MapReduce 함수

### Map 함수

`org.apache.hadoop.mapreduce.Mapper` 를 상속받아 map 메서드를 오버라이딩하여 작성합니다. 메서드에서 각 입력 텍스트 파일은 라인 단위로 호출되며 키-밸류 리스트의 형태르 입력받습니다.

</br>

Key는 입력 텍스트 파일의 맨 앞 문자를 기준으로 해당 라인의 **첫번째 문자까지의 Offset**을 값으로 가집니다. Value는 해당 텍스트 라인 전체를 값으로 가집니다.

### Reduce 함수

`org.apache.hadoop.mapreduce.Reduce` 를 상속받아 reduce 메서드를 오버라이딩 하여 작성합니다. 셔플링 페이즈의 키-밸류리스트의 출력을 입력으로 받습니다.

### Combine 함수

필요시 사용하며 맵 함수에서 출력 크기를 줄여주는 역할을 수행합니다.

 